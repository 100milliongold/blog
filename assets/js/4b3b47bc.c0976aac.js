"use strict";(self.webpackChunkmyblog_2_0=self.webpackChunkmyblog_2_0||[]).push([[3413],{25379:(e,n,d)=>{d.r(n),d.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>c});var s=d(85893),a=d(11151);const l={title:"kubernetes \uc5c5\uadf8\ub808\uc774\ub4dc \uac00\uc774\ub4dc",date:new Date("2023-11-05T15:00:48.000Z"),tags:["kubernetes","server","linux"]},r=void 0,t={permalink:"/blog/post/k8s-upgrade-guide",source:"@site/blog/k8s-upgrade-guide.mdx",title:"kubernetes \uc5c5\uadf8\ub808\uc774\ub4dc \uac00\uc774\ub4dc",description:"kubeadm \uc5c5\uadf8\ub808\uc774\ub4dc \ud655\uc778",date:"2023-11-05T15:00:48.000Z",formattedDate:"2023\ub144 11\uc6d4 5\uc77c",tags:[{label:"kubernetes",permalink:"/blog/post/tags/kubernetes"},{label:"server",permalink:"/blog/post/tags/server"},{label:"linux",permalink:"/blog/post/tags/linux"}],readingTime:2.59,hasTruncateMarker:!1,authors:[],frontMatter:{title:"kubernetes \uc5c5\uadf8\ub808\uc774\ub4dc \uac00\uc774\ub4dc",date:"2023-11-05T15:00:48.000Z",tags:["kubernetes","server","linux"]},unlisted:!1,nextItem:{title:"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc30\ud3ec \uc804\ub7b5(RollingUpdate, Blue/Green, Canary) \ubc0f \ub864\ubc31(Rollback) \uac1c\ub150\uacfc \uc124\uc815",permalink:"/blog/post/2023/03/30/\ucfe0\ubc84\ub124\ud2f0\uc2a4-\ubc30\ud3ec-\uc804\ub7b5RollingUpdate-BlueGreen-Canary-\ubc0f-\ub864\ubc31Rollback-\uac1c\ub150\uacfc-\uc124\uc815"}},i={authorsImageUrls:[]},c=[{value:"kubeadm \uc5c5\uadf8\ub808\uc774\ub4dc \ud655\uc778",id:"kubeadm-\uc5c5\uadf8\ub808\uc774\ub4dc-\ud655\uc778",level:2},{value:"\ud2b9\uc815 \ub178\ub4dc \ube44\ud65c\uc131\ud654",id:"\ud2b9\uc815-\ub178\ub4dc-\ube44\ud65c\uc131\ud654",level:2},{value:"k8s \ub808\ud37c\ub7f0\uc2a4 \uc0ac\uc774\ud2b8 \uc774\ub3d9",id:"k8s-\ub808\ud37c\ub7f0\uc2a4-\uc0ac\uc774\ud2b8-\uc774\ub3d9",level:2},{value:"\uc124\uce58\ud560 \ud328\ud0a4\uc9c0 \ud655\uc778",id:"\uc124\uce58\ud560-\ud328\ud0a4\uc9c0-\ud655\uc778",level:2},{value:"kubeadm upgrade \uc2e4\uc2dc",id:"kubeadm-upgrade-\uc2e4\uc2dc",level:2},{value:"kubeadm version \ud655\uc778",id:"kubeadm-version-\ud655\uc778",level:2},{value:"kubeadm upgrade \uc801\uc6a9",id:"kubeadm-upgrade-\uc801\uc6a9",level:2},{value:"kubelet kubectl updagrade",id:"kubelet-kubectl-updagrade",level:2},{value:"upgrade \ud55c \ub178\ub4dc\ub97c <code>Schedulable</code> \uc0c1\ud0dc\ub85c \ubcc0\uacbd",id:"upgrade-\ud55c-\ub178\ub4dc\ub97c-schedulable-\uc0c1\ud0dc\ub85c-\ubcc0\uacbd",level:2},{value:"worker node \ube44\ud65c\uc131\ud654",id:"worker-node-\ube44\ud65c\uc131\ud654",level:2},{value:"worker node \uc5c5\uadf8\ub808\uc774\ub4dc",id:"worker-node-\uc5c5\uadf8\ub808\uc774\ub4dc",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"kubeadm-\uc5c5\uadf8\ub808\uc774\ub4dc-\ud655\uc778",children:"kubeadm \uc5c5\uadf8\ub808\uc774\ub4dc \ud655\uc778"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubeadm upgrade plan\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(45827).Z+"",width:"704",height:"709"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\ub9ac\ubaa8\ud2b8 \uc11c\ubc84\uc5d0\uc11c\ub294 v1.28.3 , \ud604\uc7ac \ubc84\uc83c\uae30\uc900\uc73c\ub85c v1.26.10 \ud655\uc778 \uac00\ub2a5"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\ud2b9\uc815-\ub178\ub4dc-\ube44\ud65c\uc131\ud654",children:"\ud2b9\uc815 \ub178\ub4dc \ube44\ud65c\uc131\ud654"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"kubectl drain controlplane --ignore-daemonsets\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"kubectl drain"})," : kubectl drain\uc740 \ub178\ub4dc \uad00\ub9ac\ub97c \uc704\ud574\uc11c \uc9c0\uc815\ub41c \ub178\ub4dc\uc5d0 \uc788\ub294 \ud3ec\ub4dc\ub4e4\uc744 \ub2e4\ub978\uacf3\uc73c\ub85c \uc774\ub3d9\uc2dc\ud0a4\ub294 \uba85\ub839"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--ignore-daemonsets"})," : \ub370\ubaac\uc14b\uc73c\ub85c \uc2e4\ud589\ud55c \ud3ec\ub4dc\ub97c \ubb34\uc2dc"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(90687).Z+"",width:"704",height:"298"})}),"\n",(0,s.jsx)(n.h2,{id:"k8s-\ub808\ud37c\ub7f0\uc2a4-\uc0ac\uc774\ud2b8-\uc774\ub3d9",children:"k8s \ub808\ud37c\ub7f0\uc2a4 \uc0ac\uc774\ud2b8 \uc774\ub3d9"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/home/",children:"https://kubernetes.io/docs/home/"}),' \uc5d0\uc11c upgrade \uac80\uc0c9\ud6c4 "Upgrading kubeadm clusters\n" \ucc38\uace0']}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(47613).Z+"",width:"1258",height:"732"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"\uc5c5\uadf8\ub808\uc774\ub4dc\ud560 \ubc84\uc804 \ud655\uc778 \uc5ec\uae30\uc11c \uc21c\ucc28\uc801\uc73c\ub85c \uc801\uc6a9\ud55c\ub2e4."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(55114).Z+"",width:"1257",height:"802"})}),"\n",(0,s.jsx)(n.h2,{id:"\uc124\uce58\ud560-\ud328\ud0a4\uc9c0-\ud655\uc778",children:"\uc124\uce58\ud560 \ud328\ud0a4\uc9c0 \ud655\uc778"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"apt update\napt-cache madison kubeadm\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(96590).Z+"",width:"703",height:"732"})}),"\n",(0,s.jsx)(n.h2,{id:"kubeadm-upgrade-\uc2e4\uc2dc",children:"kubeadm upgrade \uc2e4\uc2dc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"apt-mark unhold kubeadm && \\\napt-get update && apt-get install -y kubeadm='1.27.0-00' && \\\napt-mark hold kubeadm\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(35861).Z+"",width:"706",height:"577"})}),"\n",(0,s.jsx)(n.h2,{id:"kubeadm-version-\ud655\uc778",children:"kubeadm version \ud655\uc778"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubeadm version\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(93928).Z+"",width:"697",height:"142"})}),"\n",(0,s.jsx)(n.h2,{id:"kubeadm-upgrade-\uc801\uc6a9",children:"kubeadm upgrade \uc801\uc6a9"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo kubeadm upgrade apply v1.27.0\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(12959).Z+"",width:"700",height:"865"})}),"\n",(0,s.jsx)(n.h2,{id:"kubelet-kubectl-updagrade",children:"kubelet kubectl updagrade"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"kubelet kubectl \uc124\uce58"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"apt-mark unhold kubelet kubectl && \\\napt-get update && apt-get install -y kubelet='1.27.0-00' kubectl='1.27.0-00' && \\\napt-mark hold kubelet kubectl\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(62716).Z+"",width:"701",height:"676"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\uc11c\ube44\uc2a4 \uc7ac\uc2dc\uc791"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo systemctl daemon-reload\nsudo systemctl restart kubelet\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"upgrade-\ud55c-\ub178\ub4dc\ub97c-schedulable-\uc0c1\ud0dc\ub85c-\ubcc0\uacbd",children:["upgrade \ud55c \ub178\ub4dc\ub97c ",(0,s.jsx)(n.code,{children:"Schedulable"})," \uc0c1\ud0dc\ub85c \ubcc0\uacbd"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl uncordon controlplane\n"})}),"\n",(0,s.jsx)(n.h2,{id:"worker-node-\ube44\ud65c\uc131\ud654",children:"worker node \ube44\ud65c\uc131\ud654"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl drain node01 --ignore-daemonsets\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(76816).Z+"",width:"705",height:"406"})}),"\n",(0,s.jsx)(n.h2,{id:"worker-node-\uc5c5\uadf8\ub808\uc774\ub4dc",children:"worker node \uc5c5\uadf8\ub808\uc774\ub4dc"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\uc811\uc18d\uc815\ubcf4 \ud655\uc778"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl get node -o wide\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(71810).Z+"",width:"705",height:"252"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"kubeadm \uc5c5\uadf8\ub808\uc774\ub4dc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\napt-mark unhold kubeadm && \\\napt-get update && apt-get install -y kubeadm='1.27.0-00' && \\\napt-mark hold kubeadm\n\n\n\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(32595).Z+"",width:"697",height:"851"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"sudo kubeadm upgrade node"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo kubeadm upgrade node\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"asd",src:d(73173).Z+"",width:"701",height:"316"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Upgrade kubelet and kubectl"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"apt-mark unhold kubelet kubectl && \\\napt-get update && apt-get install -y kubelet='1.27.0-00' kubectl='1.27.0-00' && \\\napt-mark hold kubelet kubectl\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"restart service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo systemctl daemon-reload\nsudo systemctl restart kubelet\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Uncordon the node"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl uncordon node01\n"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},90687:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image-0f5024118c6c6bfa411fb8a3cae534c8.png"},76816:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image10-6324fcebfc1efc7949f8b0d39a297d86.png"},71810:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image11-8e444435dceaa6c2dd79ee0b395e1849.png"},32595:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image12-10f57814881454be8cd5c01dad97c301.png"},73173:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image13-3a2719609457c94426b1a021846c51cb.png"},45827:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image2-fcc2560158d2b8a09bf2010e99b0cb7b.png"},47613:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image3-5373b53e87126fe045e6e85fee2838a4.png"},55114:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image4-3e36567de6b2f2584077f3c56b3d1633.png"},96590:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image5-5bde75a168daf447d7a8291e6bc9eb49.png"},35861:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image6-31cba656b06a2849a10f9c8d4647e399.png"},93928:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image7-2c8a054e38647ae7dbbde6bacfa5fea5.png"},12959:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image8-d2e5c38a5987de37b1e9ff944f345013.png"},62716:(e,n,d)=>{d.d(n,{Z:()=>s});const s=d.p+"assets/images/image9-5a438b87bc057d3a8be882106511dcee.png"},11151:(e,n,d)=>{d.d(n,{Z:()=>t,a:()=>r});var s=d(67294);const a={},l=s.createContext(a);function r(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);